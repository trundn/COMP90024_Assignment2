{
  "_id": "_design/movement",
  "views": {
    "movement": {
      "reduce": "function (keys, values, rereduce) {\n  if (rereduce) {\n    var result = [];\n    values.forEach(function (value) {\n      value.forEach(function (point) {\n          result.push(point);\n        }\n      )\n    });\n    \n    var uniquePoints = [];\n    result.forEach(function (point) {\n        var existing = false;\n        for (var i = 0; i < uniquePoints.length; i++) {\n            if (uniquePoints[i][0] === point[0] && uniquePoints[i][1] === point[1]) {\n                existing = true;\n                break;\n            }\n        }\n        \n        if (existing === false) {\n            uniquePoints.push(point);\n        }\n    });\n    \n    if (uniquePoints.length > 1) {\n      return uniquePoints;\n    } else {\n      return [];\n    }\n  } else {\n    return values;\n  }\n}",
      "map": "function (doc) {\n   if (doc.user && doc.calculated_coordinates) {\n    if (doc.calculated_coordinates.length == 2) {\n        emit(doc.user, [doc.calculated_coordinates[1].toFixed(3), doc.calculated_coordinates[0].toFixed(3)]);\n    }\n   }\n}"
    },
    "find-route": {
      "map": "function (doc) {\n  if (doc.raw_data && doc.calculated_coordinates.length === 2) {\n    var raw_data = doc.raw_data\n    emit([raw_data.user.id, raw_data.user.screen_name], [[doc.calculated_coordinates[1], doc.calculated_coordinates[0]], doc.created_at], 1);\n  }\n}",
      "reduce": "function (keys, values, rereduce) {\n  if (rereduce) {\n    return sum(values);\n  } else {\n    return values.length;\n  }\n}"
    },
    "noisy-data": {
      "map": "function (doc) {\n  if (doc.calculated_coordinates.length == 2) {\n    geo = doc.calculated_coordinates;\n    if (geo[0] < 100 || geo[0] > 160) {\n      emit(geo, 1);\n    }\n    if (geo[1] < -50 || geo[1] > -10) {\n      emit(geo, 1);\n    }\n  }\n}"
    }
  },
  "language": "javascript"
}